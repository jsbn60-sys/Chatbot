<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="">

<head>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <title>Y-Bot Chat Window</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            background: url("https://user-images.githubusercontent.com/62216336/108725118-53cbbc00-7526-11eb-8351-c598d4e18b9d.jpg"), rgb(252, 176, 63);
            overflow-x: hidden;
        }

        textarea {
            resize: none;
        }

        .portlet {
            margin-bottom: 15px;
        }

        .btn-warning {
            border-radius: 0 !important;
            height: 100%;
        }

        .portlet {
            border: 1px solid;
            -webkit-box-shadow: 0px 0px 34px -10px rgba(0, 0, 0, 0.75);
            -moz-box-shadow: 0px 0px 34px -10px rgba(0, 0, 0, 0.75);
            box-shadow: 0px 0px 34px -10px rgba(0, 0, 0, 0.75);
        }

        .portlet .portlet-heading h4 {
            padding: 1px 15px;
            font-size: 16px;
        }

        .portlet .portlet-heading a {
            color: #fff;
        }

        .portlet .portlet-heading a:hover,
        .portlet .portlet-heading a:active,
        .portlet .portlet-heading a:focus {
            outline: none;
        }

        .portlet .portlet-widgets .dropdown-menu a {
            color: #333;
        }

        .portlet .portlet-widgets ul.dropdown-menu {
            min-width: 0;
        }

        .portlet .portlet-heading .portlet-title {
            float: left;
        }

        .portlet .portlet-heading .portlet-title h4 {
            margin: 10px 0;
        }

        .portlet .portlet-heading .portlet-widgets {
            float: right;
            margin: 8px 0;
        }

        .portlet .portlet-heading .portlet-widgets .tabbed-portlets {
            display: inline;
        }

        .portlet .portlet-heading .portlet-widgets .divider {
            margin: 0 5px;
        }

        .portlet .portlet-body {
            padding: 15px;
            background: #fff;
        }

        .portlet .portlet-footer {
            padding: 10px 15px;
            background: #e0e7e8;
        }

        .portlet .portlet-footer ul {
            margin: 0;
        }

        .portlet-green,
        .portlet-green > .portlet-heading {
            border-color: #16a085;
        }

        .portlet-green > .portlet-heading {
            color: #fff;
            background-color: #16a085;
        }

        .portlet-orange,
        .portlet-orange > .portlet-heading {
            border-color: #f39c12;
        }

        .portlet-orange > .portlet-heading {
            color: #fff;
            background-color: #f39c12;
        }

        .portlet-blue,
        .portlet-blue > .portlet-heading {
            border-color: #2980b9;
        }

        .portlet-blue > .portlet-heading {
            color: #fff;
            background-color: #2980b9;
        }

        .portlet-red,
        .portlet-red > .portlet-heading {
            border-color: #e74c3c;
        }

        .portlet-red > .portlet-heading {
            color: #fff;
            background-color: #e74c3c;
        }

        .portlet-purple,
        .portlet-purple > .portlet-heading {
            border-color: #8e44ad;
        }

        .portlet-purple > .portlet-heading {
            color: #fff;
            background-color: #8e44ad;
        }

        .portlet-default,
        .portlet-dark-blue,
        .portlet-default > .portlet-heading,
        .portlet-dark-blue > .portlet-heading {
            border-color: #34495e;
        }

        .portlet-default > .portlet-heading,
        .portlet-dark-blue > .portlet-heading {
            color: #fff;
            background-color: #34495e;
        }

        .portlet-basic,
        .portlet-basic > .portlet-heading {
            border-color: #333;
        }

        .portlet-basic > .portlet-heading {
            border-bottom: 1px solid #333;
            color: #333;
            background-color: #fff;
        }

        @media (min-width: 768px) {
            .portlet {
                margin-bottom: 30px;
            }
        }

        li {
            font-size: 1.6rem;
        }

        .img-chat {
            width: 40px;
            height: 40px;
        }

        .text-green {
            color: #16a085;
        }

        .text-orange {
            color: #f39c12;
        }

        .text-red {
            color: #e74c3c;
        }

        .small_icon {
            height: 2rem;
            width: 2rem;
        }
    </style>
</head>

<body>
<div class="columnsContainer">

    <div class="">
        <div class="container bootstrap snippets bootdey">
            <div class="row" style="padding-top: 5%">
                <div class="col-md-10 col-md-offset-1">
                    <div class="portlet portlet-default">
                        <div class="portlet-heading">
                            <button id="audio_off" class="btn btn-warning btn-lg pull-right"><img class="small_icon"
                                                                                                  src="https://user-images.githubusercontent.com/62216336/109061583-20845b00-76e7-11eb-86b3-779c85385c5c.png">
                            </button>
                            <button id="audio_on" class="btn btn-warning btn-lg pull-right"><img class="small_icon"
                                                                                                 src="https://user-images.githubusercontent.com/62216336/109061574-1f532e00-76e7-11eb-82dc-0e2e79db9fdf.png">
                            </button>
                            <div class="portlet-title">
                                <h4><i class=" text-green"></i>Easybot</h4>
                            </div>
                            <div class="clearfix"></div>
                        </div>
                        <div id="chat" class="panel-collapse collapse in">
                            <div>
                                <div class="portlet-body chat-widget" id="chatwidget"
                                     style="overflow-y: auto; width: auto; height: 600px;">
                                    <div class="row" id="greetline">
                                        <div class="col-lg-12">
                                            <p class="text-center text-muted small" id="dateText"></p>
                                        </div>
                                        <hr>
                                    </div>
                                    <div id="robogif" hidden>
                                        <img src="https://cliply.co/wp-content/uploads/2019/05/371905140_MEET_ROBOT_400px.gif"
                                             class="center-block" alt="" style="width: 43%">
                                        <h3 style="text-align: center">Auf Wiedersehen!</h3>
                                    </div>
                                    <div id="chatbox">
                                    </div>
                                </div>
                            </div>
                            <div class="portlet-footer">
                                <form name="message" action="">
                                    <div class="form-group w-75">
                                        <textarea name="usermsg" id="usermsg" class="form-control" style="resize: none"
                                                  placeholder="Gebe Nachricht ein..."></textarea>
                                        <div id="sourcetext" class="text-center" hidden>
                                            <a href="https://cliply.co/clip/robot-waving/">Gif-Source</a>
                                        </div>
                                    </div>
                                    <div class="form-group" id="buttonscontainer">
                                        <button name="submitmsg" id="submitmsg" value="Send" type="button"
                                                class="btn btn-primary pull-right">Senden
                                        </button>
                                        <button name="goodbye" id="goodbye" value="Send" type="button"
                                                class="btn btn-danger pull-left">Verabschieden
                                        </button>
                                        <div class="clearfix"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-5 col-md-offset-5">
            <div id="questionswrapper">
                <p>
                <h3>Beliebte Fragen</h3></p>
                <ul>
                    <li class="question"><a href="#">Erzähl mir einen Witz</a></li>
                    <li class="question"><a href="#">Wie funktionierst du ?</a></li>
                    <li class="question"><a href="#">Was weißt du über mich ?</a></li>
                    <li class="question"><a href="#">Wie gehts dir ?</a></li>
                    <li class="question"><a href="#">Kannst du ein Thema vorschlagen ?</a></li>
                    <li class="question"><a href="#">Wer ist Albert Einstein ?</a></li>
                </ul>
            </div>
        </div>
    </div>

</div>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script>
    let muted;
    let last_response;
    // jQuery Document
    $(document).ready(function () {

        speak_text = function (text) {
            if (text == null || muted) {
                return;
            }
            myTimeout = setTimeout(myTimer, 10000);

            var msg = new SpeechSynthesisUtterance();
            msg.lang = 'de-DE';
            msg.text = text;
            msg.onend = function () {
                clearTimeout(myTimeout);
            }
            window.speechSynthesis.speak(msg);

        }
        ask_question = function (question, show_question) {
            var xhttp = new XMLHttpRequest();
            xhttp.onload = function () {
                if (this.status == 200 && this.responseText != null) {

                    var response = JSON.parse(this.responseText);

                    if (show_question == true) {
                        $("#chatbox").append("<p><hr style='border-color:red'/></p>");
                        $("#chatbox").append("<p><b>You:</b> " + response.response.question + "</p>");
                    }
                    last_response = response.response.answer.replace(/([a-z])([A-Z]|[0-9]|Ä|Ö|Ü)/g, '$1 $2');


                    speak_text(last_response);
                    $("#chatbox").append("<p><b>Bot:</b> " + last_response + "</p>");

                    $("#chatwidget")[0].scrollTop = $("#chatwidget")[0].scrollHeight;
                }
            }

            xhttp.open("GET", "/api/web/v1.0/ask?question=" + question);
            xhttp.setRequestHeader("Content-type", "sapplication/json");
            xhttp.send();

            return false;
        }


        ask_question("YINITIALQUESTION", false)
        $("#dateText").text("Du bist mit Easybot verbunden");
        muted = true;
        $("#audio_on").show();
        $("#audio_off").hide();

        $(".question").click(function () {
            var question = $(this).text()
            return ask_question(question, true)
        });

        $(document).on('click', '.programy', function () {
            var question = "";
            var attr = $(this).attr('postback');
            if (typeof attr !== typeof undefined && attr !== false) {
                question = attr
            } else {
                question = $(this).text();
            }
            return ask_question(question, true)
        });

        $("#audio_off").click(function () {
            muted = true;
            window.speechSynthesis.cancel();
            $("#audio_on").show();
            $("#audio_off").hide();
        });

        $("#audio_on").click(function () {
            muted = false;
            speak_text(last_response);
            $("#audio_off").show();
            $("#audio_on").hide();

        });


        $("#submitmsg").click(function () {
            var question = $("#usermsg").val();
            $("#usermsg").val("");
            return ask_question(question, true)
        });

        $("#goodbye").click(function () {
            $("#chatbox").text("");
            $("#greetline").text("");
            $("#robogif").show();
            $("#usermsg").hide();
            $("#buttonscontainer").hide();
            $("#questionswrapper").hide();
            $("#sourcetext").show();
        });

        $("#usermsg").keypress(function (e) {
            if (e.which == 13 && !e.shiftKey) {
                var question = $("#usermsg").val();
                $("#usermsg").val("");
                e.preventDefault();
                return ask_question(question, true)
            }
        });

        var myTimeout;

        function myTimer() {
            window.speechSynthesis.pause();
            window.speechSynthesis.resume();
            myTimeout = setTimeout(myTimer, 10000);
        }


    });

</script>
</body>
</html>
